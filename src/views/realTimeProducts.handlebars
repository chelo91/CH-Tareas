{{> tableProducts products=products }}
<script src="socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let products = [];

    document.addEventListener("DOMContentLoaded", function () {
        socket.on('products', (initialProducts) => {
            products = initialProducts;
            refreshTable();
        });

        socket.on('create-product', ({ product }) => {
            Swal.fire({
                icon: 'success',
                title: 'Producto creado',
                text: "" + product.id + " - " + product.title,
                timer: 1500,
                timerProgressBar: true
            });
            products.push(product);
            refreshTable();
        });

        socket.on('delete-product', ({ id }) => {
            Swal.fire({
                icon: 'warning',
                title: 'Producto eliminado',
                text: "ID: " + id,
                timer: 1500,
                timerProgressBar: true
            });
            products = products.filter(product => product.id !== id);
            refreshTable();
        });

        function refreshTable() {
            const tbody = document.getElementById("tableProductsBody");
            tbody.innerHTML = "";
            products.forEach((product) => {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${product.id}</td>
                                <td>${product.title}</td>
                                <td>${product.description}</td>
                                <td>${product.code}</td>
                                <td>${product.price}</td>
                                <td>${product.status}</td>
                                <td>${product.stock}</td>
                                <td>${product.category}</td>`;

                tbody.appendChild(row);
            });
        }
    });


    /*const messageList = document.getElementById('message-list');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');

    // Función para agregar un mensaje al DOM
    function addMessage(socketId, message) {
        const listItem = document.createElement('li');
        listItem.textContent = `${socketId}: ${message}`;
        messageList.appendChild(listItem);
    }

    // Escucha eventos 'message' y actualiza la lista de mensajes
    socket.on('product', ({ socketId, message }) => {
        addMessage(socketId, message);
    });

    // Escucha el evento 'messages' inicial para cargar los mensajes existentes
    socket.on('products', (initialMessages) => {
        initialMessages.forEach(({ socketId, message }) => {
            addMessage(socketId, message);
        });
    });

    // Enviar mensaje cuando se hace clic en el botón
    sendButton.addEventListener('click', () => {
        const message = messageInput.value;
        socket.emit('product', message);
        messageInput.value = '';
    });*/
</script>